/*! heartcode-canvasloader 2013-12-29 */
!function(a){"use strict";var b,c=function(a,b){b=b||{},this._init(a,b)},d=c.prototype,e=["canvas","vml"],f=["oval","spiral","square","rect","roundRect"],g=/^\#([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$/,h=-1!==navigator.appVersion.indexOf("MSIE")&&8===parseFloat(navigator.appVersion.split("MSIE")[1])?!0:!1,i=!!document.createElement("canvas").getContext,j=40,k=!0,l=function(a,b,c){var d,e=document.createElement(a);for(d in c)e[d]=c[d];return"undefined"!=typeof b&&b.appendChild(e),e},m=function(a,b){for(var c in b)a.style[c]=b[c];return a},n=function(a,b){for(var c in b)a.setAttribute(c,b[c]);return a},o=function(a,b,c,d){a.save(),a.translate(b,c),a.rotate(d),a.translate(-b,-c),a.beginPath()};d._settings={shape:"oval",color:"#000000",diameter:40,range:.2,density:40,speed:2,fps:60,autoShow:!0},d._defaults=d._settings,d._cont=null,d._can=null,d._con=null,d._cCan=null,d._cCon=null,d._timer=0,d._currentId=0,d._diameter=d._settings.diameter,d._cRGB={},d._color=d._settings.color,d._shape=d._settings.shape,d._density=d._settings.density,d._range=d._settings.range,d._speed=d._settings.speed,d._fps=d._settings.fps,d._init=function(a,d){var h=this._settings;if(this.mum=a,this._cont=l("div",this.mum,{className:"canvasloader"}),i)b=e[0],this._can=l("canvas",this._cont),this._con=this._can.getContext("2d"),this._cCan=m(l("canvas",this._cont),{display:"none"}),this._cCon=this._cCan.getContext("2d");else{if(b=e[1],"undefined"==typeof c.vmlSheet){document.getElementsByTagName("head")[0].appendChild(l("style")),c.vmlSheet=document.styleSheets[document.styleSheets.length-1];for(var n=["group","oval","roundrect","fill"],o=0;o<n.length;++o)c.vmlSheet.addRule(n[o],"behavior:url(#default#VML); position:absolute;")}this.vml=l("group",this._cont)}for(var p=d.shape||h.shape,q=0;q<f.length;q++)if(p===f[q]){this._shape=p;break}k=d.safeVML||!0;var r=d.diameter||h.diameter;this._diameter=Math.round(Math.abs(r)),m(this.mum,{"margin-left":Math.round(r*-.5)+"px"});var s=d.density||h.density;this._density=k&&b===e[1]?Math.round(Math.abs(s))<=j?Math.round(Math.abs(s)):j:Math.round(Math.abs(s)),this._density>360&&(this._density=360),this._currentId=0;var t=d.color;this._color=g.test(t)?t:h.color,this._cRGB=this._getRGB(this._color),this._range=Math.abs(d.range||h.range),this._speed=Math.round(Math.abs(d.speed||h.speed)),this._fps=Math.round(Math.abs(d.fps||h.fps)),this._draw(),m(this._cont,{visibility:"hidden",display:"none"});var u=d.autoShow||h.autoShow;u&&this.show()},d._getRGB=function(a){return a="#"===a.charAt(0)?a.substring(1,7):a,{r:parseInt(a.substring(0,2),16),g:parseInt(a.substring(2,4),16),b:parseInt(a.substring(4,6),16)}},d._getDefaults=function(){return this._defaults},d._draw=function(){var a,c,d,g,i,j,k,p,q,r,s,t,u,v=0,w=this._density,x=Math.round(w*this._range),y=0,z=1e3,A=0,B=this._cCon,C=this._diameter,D=.47;if(b===e[0])for(B.clearRect(0,0,z,z),n(this._can,{width:C,height:C}),n(this._cCan,{width:C,height:C});w>v;){switch(q=x>=v?1-(1-y)/x*v:q=y,j=270-360/w*v,k=j/180*Math.PI,B.fillStyle="rgba("+this._cRGB.r+","+this._cRGB.g+","+this._cRGB.b+","+q.toString()+")",this._shape){case f[0]:case f[1]:a=.07*C,g=C*D+Math.cos(k)*(C*D-a)-C*D,i=C*D+Math.sin(k)*(C*D-a)-C*D,B.beginPath(),this._shape===f[1]?B.arc(.5*C+g,.5*C+i,a*q,0,2*Math.PI,!1):B.arc(.5*C+g,.5*C+i,a,0,2*Math.PI,!1);break;case f[2]:a=.12*C,g=Math.cos(k)*(C*D-a)+.5*C,i=Math.sin(k)*(C*D-a)+.5*C,o(B,g,i,k),B.fillRect(g,i-.5*a,a,a);break;case f[3]:case f[4]:c=.3*C,d=.27*c,g=Math.cos(k)*(d+.13*(C-d))+.5*C,i=Math.sin(k)*(d+.13*(C-d))+.5*C,o(B,g,i,k),this._shape===f[3]?B.fillRect(g,i-.5*d,c,d):(p=.55*d,B.moveTo(g+p,i-.5*d),B.lineTo(g+c-p,i-.5*d),B.quadraticCurveTo(g+c,i-.5*d,g+c,i-.5*d+p),B.lineTo(g+c,i-.5*d+d-p),B.quadraticCurveTo(g+c,i-.5*d+d,g+c-p,i-.5*d+d),B.lineTo(g+p,i-.5*d+d),B.quadraticCurveTo(g,i-.5*d+d,g,i-.5*d+d-p),B.lineTo(g,i-.5*d+p),B.quadraticCurveTo(g,i-.5*d,g+p,i-.5*d))}B.closePath(),B.fill(),B.restore(),++v}else{switch(m(this._cont,{width:C,height:C}),m(this.vml,{width:C,height:C}),this._shape){case f[0]:case f[1]:t="oval",a=.14*z;break;case f[2]:t="roundrect",a=.12*z;break;case f[3]:case f[4]:t="roundrect",a=.3*z}for(c=d=a,g=.5*z-d,i=.5*-d;w>v;){switch(q=x>=v?1-(1-y)/x*v:q=y,j=270-360/w*v,this._shape){case f[1]:c=d=a*q,g=.5*z-.5*a-a*q*.5,i=.5*(a-a*q);break;case f[0]:case f[2]:h&&(i=0,this._shape===f[2]&&(g=.5*z-.5*d));break;case f[3]:case f[4]:c=.95*a,d=.28*c,h?(g=0,i=.5*z-.5*d):(g=.5*z-c,i=.5*-d),A=this._shape===f[4]?.6:0}s=n(m(l("group",this.vml),{width:z,height:z,rotation:j}),{coordsize:z+","+z,coordorigin:.5*-z+","+.5*-z}),r=m(l(t,s,{stroked:!1,arcSize:A}),{width:c,height:d,top:i,left:g}),u=l("fill",r,{color:this._color,opacity:q}),++v}}this._tick(!0)},d._tick=function(a){var c=this._con,d=this._diameter;a||(this._currentId+=360/this._density*this._speed),b===e[0]?(c.clearRect(0,0,d,d),o(c,.5*d,.5*d,this._currentId/180*Math.PI),c.drawImage(this._cCan,0,0,d,d),c.restore()):(this._currentId>=360&&(this._currentId-=360),m(this.vml,{rotation:this._currentId}))},d.show=function(){var a=this;return a._timer||(a._timer=setInterval(function(){a._tick()},Math.round(1e3/a._fps)),m(a._cont,{visibility:"visible",display:"block"})),a},d.hide=function(){return this._timer&&(clearInterval(this._timer),this._timer=null,m(this._cont,{visibility:"hidden",display:"none"})),this},d.destruct=function(){this.hide(),this.mum.removeChild(this._cont);for(var a in this)delete this[a],this[a]=null},d.get=function(a){return"defaults"===a?this._getDefaults():this._settings.hasOwnProperty(a)&&this.hasOwnProperty("_"+a)?this["_"+a]:void 0},a.CanvasLoader=c}(window),function(a){a.fn.hcl=function(b){return this.each(function(){var c=a.data(this,"hcl");c&&"function"==typeof c.destruct&&c.destruct(),a.data(this,"hcl",new CanvasLoader(this,b))})}}(jQuery);
/*! canvasloader 2014-04-29 */
!function(a){"use strict";var b,c=function(a,b){b=b||{},this._init(a,b)},d=c.prototype,e=["canvas","vml"],f=["oval","spiral","square","rect","roundRect"],g=/^\#([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$/,h=-1!==navigator.appVersion.indexOf("MSIE")&&8===parseFloat(navigator.appVersion.split("MSIE")[1])?!0:!1,i=!!document.createElement("canvas").getContext,j=40,k=!0,l=function(a,b,c){var d,e=document.createElement(a);for(d in c)e[d]=c[d];return"undefined"!=typeof b&&b.appendChild(e),e},m=function(a,b){for(var c in b)a.style[c]=b[c];return a},n=function(a,b){for(var c in b)a.setAttribute(c,b[c]);return a},o=function(){for(var a=document.body.appendChild(document.createElement("div")),b=!1,c="webkit moz o ms khtml".split(" "),d=0;d<=c.length;d++){var e=d===c.length?"animation":c[d]+"Animation";if("undefiend"!=typeof a.style[e]){b=!0;break}}return b},p=function(a,b,c,d){a.save(),a.translate(b,c),a.rotate(d),a.translate(-b,-c),a.beginPath()};d._settings={shape:"oval",color:"#000000",diameter:40,range:.2,density:40,speed:2,fps:60,autoShow:!0},d._defaults=d._settings,d._cont=null,d._can=null,d._con=null,d._cCan=null,d._cCon=null,d._timer=0,d._currentId=0,d._diameter=d._settings.diameter,d._cRGB={},d._color=d._settings.color,d._shape=d._settings.shape,d._density=d._settings.density,d._range=d._settings.range,d._speed=d._settings.speed,d._fps=d._settings.fps,d._init=function(a,d){var h=this._settings;if(this.mum=a,this._cont=l("div",this.mum,{className:"canvasloader"}),i)b=e[0],this._can=l("canvas",this._cont),this._con=this._can.getContext("2d"),this._cCan=m(l("canvas",this._cont),{display:"none"}),this._cCon=this._cCan.getContext("2d");else{if(b=e[1],"undefined"==typeof c.vmlSheet){document.getElementsByTagName("head")[0].appendChild(l("style")),c.vmlSheet=document.styleSheets[document.styleSheets.length-1];for(var n=["group","oval","roundrect","fill"],o=0;o<n.length;++o)c.vmlSheet.addRule(n[o],"behavior:url(#default#VML); position:absolute;")}this.vml=l("group",this._cont)}for(var p=d.shape||h.shape,q=0;q<f.length;q++)if(p===f[q]){this._shape=p;break}k=d.safeVML||!0;var r=d.diameter||h.diameter;this._diameter=r,m(this.mum,{marginLeft:Math.round(r*-.5)+"px"});var s=d.density||h.density;this._density=k&&b===e[1]?Math.round(Math.abs(s))<=j?Math.round(Math.abs(s)):j:Math.round(Math.abs(s)),this._density>360&&(this._density=360),this._currentId=0;var t=d.color;this._color=g.test(t)?t:h.color,this._cRGB=this._getRGB(this._color),this._range=Math.abs(d.range||h.range),this._speed=Math.round(Math.abs(d.speed||h.speed)),this._fps=Math.round(Math.abs(d.fps||h.fps)),this._draw(),m(this._cont,{visibility:"hidden",display:"none"});var u=d.autoShow||h.autoShow;u&&this.show()},d._getRGB=function(a){return a="#"===a.charAt(0)?a.substring(1,7):a,{r:parseInt(a.substring(0,2),16),g:parseInt(a.substring(2,4),16),b:parseInt(a.substring(4,6),16)}},d._getDefaults=function(){return this._defaults},d._draw=function(){var c,d,g,i,j,k,o,q,r,s,t,u,v,w=0,x=this._density,y=Math.round(x*this._range),z=0,A=1e3,B=0,C=this._cCon,D=this._diameter,E=.47,F=a.devicePixelRatio||1;if(b===e[0])for(C.clearRect(0,0,A,A),n(this._can,{width:D*F,height:D*F}),m(this._can,{width:D+"px",height:D+"px"}),n(this._cCan,{width:D*F,height:D*F}),m(this._cCan,{width:D+"px",height:D+"px"}),C.scale(F,F),this._con.scale(F,F);x>w;){switch(r=y>=w?1-(1-z)/y*w:r=z,k=270-360/x*w,o=k/180*Math.PI,C.fillStyle="rgba("+this._cRGB.r+","+this._cRGB.g+","+this._cRGB.b+","+r.toString()+")",this._shape){case f[0]:case f[1]:c=.07*D,i=D*E+Math.cos(o)*(D*E-c)-D*E,j=D*E+Math.sin(o)*(D*E-c)-D*E,C.beginPath(),this._shape===f[1]?C.arc(.5*D+i,.5*D+j,c*r,0,2*Math.PI,!1):C.arc(.5*D+i,.5*D+j,c,0,2*Math.PI,!1);break;case f[2]:c=.12*D,i=Math.cos(o)*(D*E-c)+.5*D,j=Math.sin(o)*(D*E-c)+.5*D,p(C,i,j,o),C.fillRect(i,j-.5*c,c,c);break;case f[3]:case f[4]:d=.3*D,g=.27*d,i=Math.cos(o)*(g+.13*(D-g))+.5*D,j=Math.sin(o)*(g+.13*(D-g))+.5*D,p(C,i,j,o),this._shape===f[3]?C.fillRect(i,j-.5*g,d,g):(q=.55*g,C.moveTo(i+q,j-.5*g),C.lineTo(i+d-q,j-.5*g),C.quadraticCurveTo(i+d,j-.5*g,i+d,j-.5*g+q),C.lineTo(i+d,j-.5*g+g-q),C.quadraticCurveTo(i+d,j-.5*g+g,i+d-q,j-.5*g+g),C.lineTo(i+q,j-.5*g+g),C.quadraticCurveTo(i,j-.5*g+g,i,j-.5*g+g-q),C.lineTo(i,j-.5*g+q),C.quadraticCurveTo(i,j-.5*g,i+q,j-.5*g))}C.closePath(),C.fill(),C.restore(),++w}else{switch(m(this._cont,{width:D,height:D}),m(this.vml,{width:D,height:D}),this._shape){case f[0]:case f[1]:u="oval",c=.14*A;break;case f[2]:u="roundrect",c=.12*A;break;case f[3]:case f[4]:u="roundrect",c=.3*A}for(d=g=c,i=.5*A-g,j=.5*-g;x>w;){switch(r=y>=w?1-(1-z)/y*w:r=z,k=270-360/x*w,this._shape){case f[1]:d=g=c*r,i=.5*A-.5*c-c*r*.5,j=.5*(c-c*r);break;case f[0]:case f[2]:h&&(j=0,this._shape===f[2]&&(i=.5*A-.5*g));break;case f[3]:case f[4]:d=.95*c,g=.28*d,h?(i=0,j=.5*A-.5*g):(i=.5*A-d,j=.5*-g),B=this._shape===f[4]?.6:0}t=n(m(l("group",this.vml),{width:A,height:A,rotation:k}),{coordsize:A+","+A,coordorigin:.5*-A+","+.5*-A}),s=m(l(u,t,{stroked:!1,arcSize:B}),{width:d,height:g,top:j,left:i}),v=l("fill",s,{color:this._color,opacity:r}),++w}}this._renderWithSoftware(!0)},d._renderWithSoftware=function(a){var c=this._con,d=this._diameter;a||(this._currentId+=360/this._density*this._speed),b===e[0]?(c.clearRect(0,0,d,d),p(c,.5*d,.5*d,this._currentId/180*Math.PI),c.drawImage(this._cCan,0,0,d,d),c.restore()):(this._currentId>=360&&(this._currentId-=360),m(this.vml,{rotation:this._currentId}))},d._renderWithHardware=function(){for(var a="1s",b=["webkitAnimation","mozAnimation","oAnimation","msAnimation","khtmlAnimation","animation"],c="spin "+a+" steps("+this._density+") infinite",d={},e=0;e<b.length;e++)d[b[e]]=c;m(this._can,d)},d.show=function(){var a=this;return m(a._cont,{visibility:"visible",display:"block"}),o()?(document.body.style.background="rgba(255, 0, 0, 0.2)",this._renderWithHardware()):a._timer||(a._timer=setInterval(function(){a._renderWithSoftware()},Math.round(1e3/a._fps))),a},d.hide=function(){return this._timer&&(clearInterval(this._timer),this._timer=null,m(this._cont,{visibility:"hidden",display:"none"})),this},d.destruct=function(){this.hide(),this.mum.removeChild(this._cont);for(var a in this)delete this[a],this[a]=null},d.get=function(a){return"defaults"===a?this._getDefaults():this._settings.hasOwnProperty(a)&&this.hasOwnProperty("_"+a)?this["_"+a]:void 0},a.CanvasLoader=c}(window),function(a){a.fn.hcl=function(b){return this.each(function(){var c=a.data(this,"hcl");c&&"function"==typeof c.destruct&&c.destruct(),a.data(this,"hcl",new CanvasLoader(this,b))})}}(jQuery);
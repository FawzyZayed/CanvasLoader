/*! canvasloader 2014-08-20 */
!function(a){"use strict";var b=function(a,b){b=b||{},this._init(a,b)},c=b.prototype;c._shapes=["oval","spiral","square","rect","roundRect"],c._colorRegEx=/^\#([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$/,c._supportsCanvas=!!document.createElement("canvas").getContext,c._settings={shape:"oval",color:"#000000",diameter:40,range:.2,density:40,duration:1,autoShow:!0},c._defaultSettings=c._settings,c._container=null,c._canvas=null,c._context=null,c._cacheCanvas=null,c._cacheContext=null,c._timer=0,c._currentDegree=0,c._diameter=c._settings.diameter,c._cRGB={},c._color=c._settings.color,c._shape=c._settings.shape,c._density=c._settings.density,c._range=c._settings.range,c._duration=c._settings.duration,c._addElement=function(a,b,c){var d,e=document.createElement(a);for(d in c)e[d]=c[d];return"undefined"!=typeof b&&b.appendChild(e),e},c._setCSS=function(a,b){for(var c in b)a.style[c]=b[c];return a},c._setAttribute=function(a,b){for(var c in b)a.setAttribute(c,b[c]);return a},c._supportsKeyframes=function(){for(var a=document.body.appendChild(document.createElement("div")),b=!1,c="webkit moz o ms khtml".split(" "),d=0;d<=c.length;d++){var e=d===c.length?"animation":c[d]+"Animation";if("undefined"!=typeof a.style[e]){b=!0;break}}return b},c._transformCachedCanvasContext=function(a,b,c,d){a.save(),a.translate(b,c),a.rotate(d),a.translate(-b,-c),a.beginPath()},c._init=function(a,b){var d=this._settings;if(this.dad=a,this._container=c._addElement("div",this.dad,{className:"canvasloader"}),this._supportsCanvas?(this._canvas=c._addElement("canvas",this._container),this._context=this._canvas.getContext("2d"),this._cacheCanvas=c._setCSS(c._addElement("canvas",this._container),{display:"none"}),this._cacheContext=this._cacheCanvas.getContext("2d")):console.warn("[CanvasLoader] - Browser won't support canvas, bye!"),this._supportsKeyframes()&&!document.getElementById("cl-sheet")){var e=this._addElement("style",document.getElementsByTagName("head")[0]);this._setAttribute(e,{id:"cl-sheet"}),e=document.getElementById("cl-sheet");for(var f=["@-webkit-keyframes","@-moz-keyframes","@-o-keyframes","@keyframes"],g="from {transform: rotateZ(0deg);} to {transform: rotateZ(360deg);}",h=0;h<f.length;h++){var i=f[h].indexOf("@")+1,j=f[h].indexOf("-keyframes")+1,k=f[h].substring(i,j),l=new RegExp("transform","g"),m="@"!==k?g.replace(l,k+"transform"):g;e.innerHTML+="\n\n"+f[h]+" cl-spin {"+m+"}"}}for(var n=b.shape||d.shape,h=0;h<this._shapes.length;h++)if(n===this._shapes[h]){this._shape=n;break}var o=b.diameter||d.diameter;this._diameter=o,this._setCSS(this.dad,{marginLeft:Math.round(o*-.5)+"px"});var p=b.density||d.density;this._density=Math.round(Math.abs(p)),this._currentDegree=0,this._degreeBlock=360/this._density;var q=b.color;this._color=this._colorRegEx.test(q)?q:d.color,this._cRGB=this._getRGB(this._color),this._range=Math.abs(b.range||d.range),this._duration=Math.abs(b.duration||d.duration),this._renderInterval=Math.round(1e3*this._duration/this._density),this._draw(),this._setCSS(this._container,{visibility:"hidden",display:"none"});var r=b.autoShow||d.autoShow;r&&this.show()},c._getRGB=function(a){return a="#"===a.charAt(0)?a.substring(1,7):a,{r:parseInt(a.substring(0,2),16),g:parseInt(a.substring(2,4),16),b:parseInt(a.substring(4,6),16)}},c._getDefaults=function(){return this._defaultSettings},c._draw=function(){var a,b,c,d,e,f,g,h,i,j=0,k=this._density,l=Math.round(k*this._range),m=0,n=1e3,o=this._cacheContext,p=this._diameter,q=.47,r=4;for(o.clearRect(0,0,n,n),this._setAttribute(this._canvas,{width:p*r,height:p*r}),this._setCSS(this._canvas,{width:p+"px",height:p+"px"}),this._setAttribute(this._cacheCanvas,{width:p*r,height:p*r}),this._setCSS(this._cacheCanvas,{width:p+"px",height:p+"px"}),o.scale(r,r),this._context.scale(r,r);k>j;){switch(i=l>=j?1-(1-m)/l*j:i=m,f=270-360/k*j,g=f/180*Math.PI,o.fillStyle="rgba("+this._cRGB.r+","+this._cRGB.g+","+this._cRGB.b+","+i.toString()+")",this._shape){case this._shapes[0]:case this._shapes[1]:a=.07*p,d=p*q+Math.cos(g)*(p*q-a)-p*q,e=p*q+Math.sin(g)*(p*q-a)-p*q,o.beginPath(),this._shape===this._shapes[1]?o.arc(.5*p+d,.5*p+e,a*i,0,2*Math.PI,!1):o.arc(.5*p+d,.5*p+e,a,0,2*Math.PI,!1);break;case this._shapes[2]:a=.12*p,d=Math.cos(g)*(p*q-a)+.5*p,e=Math.sin(g)*(p*q-a)+.5*p,this._transformCachedCanvasContext(o,d,e,g),o.fillRect(d,e-.5*a,a,a);break;case this._shapes[3]:case this._shapes[4]:b=.3*p,c=.27*b,d=Math.cos(g)*(c+.13*(p-c))+.5*p,e=Math.sin(g)*(c+.13*(p-c))+.5*p,this._transformCachedCanvasContext(o,d,e,g),this._shape===this._shapes[3]?o.fillRect(d,e-.5*c,b,c):(h=.55*c,o.moveTo(d+h,e-.5*c),o.lineTo(d+b-h,e-.5*c),o.quadraticCurveTo(d+b,e-.5*c,d+b,e-.5*c+h),o.lineTo(d+b,e-.5*c+c-h),o.quadraticCurveTo(d+b,e-.5*c+c,d+b-h,e-.5*c+c),o.lineTo(d+h,e-.5*c+c),o.quadraticCurveTo(d,e-.5*c+c,d,e-.5*c+c-h),o.lineTo(d,e-.5*c+h),o.quadraticCurveTo(d,e-.5*c,d+h,e-.5*c))}o.closePath(),o.fill(),o.restore(),++j}this._render(!0)},c._render=function(a){if(this._supportsKeyframes()){this._context.drawImage(this._cacheCanvas,0,0,this._diameter,this._diameter);for(var b=["webkitAnimation","mozAnimation","oAnimation","animation"],c="cl-spin "+this._duration+"s steps("+this._density+") infinite",d={},e=0;e<b.length;e++)d[b[e]]=c;this._setCSS(this._canvas,d)}else{var f=this;a?this._currentDegree=0:(this._currentDegree+=this._degreeBlock,this._currentDegree>360&&(this._currentDegree-=360)),this._context.clearRect(0,0,this._diameter,this._diameter),this._transformCachedCanvasContext(this._context,.5*this._diameter,.5*this._diameter,this._currentDegree/180*Math.PI),this._context.drawImage(this._cacheCanvas,0,0,this._diameter,this._diameter),this._context.restore(),f._timer||(f._timer=setInterval(function(){f._render()},f._renderInterval))}},c.get=function(a){return"defaults"===a?this._getDefaults():this._settings.hasOwnProperty(a)&&this.hasOwnProperty("_"+a)?this["_"+a]:void 0},c.show=function(){return this._setCSS(this._container,{visibility:"visible",display:"block"}),this._render(!0),self},c.hide=function(){return this._timer&&(clearInterval(this._timer),this._timer=null,this._setCSS(this._container,{visibility:"hidden",display:"none"})),this},c.destruct=function(){this.hide(),this.dad.removeChild(this._container);for(var a in this)delete this[a],this[a]=null},a.CanvasLoader=b}(window),function(a){a.fn.hcl=function(b){return this.each(function(){var c=a.data(this,"hcl");c&&"function"==typeof c.destruct&&c.destruct(),a.data(this,"hcl",new CanvasLoader(this,b))})}}(jQuery);
/*! heartcode-canvasloader 2013-12-19 */
!function(a){"use strict";var b,c=function(a,b){b=b||{},this._init(a,b)},d=c.prototype,e=["canvas","vml"],f=["oval","spiral","square","rect","roundRect"],g=/^\#([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$/,h=-1!==navigator.appVersion.indexOf("MSIE")&&8===parseFloat(navigator.appVersion.split("MSIE")[1])?!0:!1,i=!!document.createElement("canvas").getContext,j=40,k=!0,l=function(a,b,c){var d,e=document.createElement(a);for(d in c)e[d]=c[d];return"undefined"!=typeof b&&b.appendChild(e),e},m=function(a,b){for(var c in b)a.style[c]=b[c];return a},n=function(a,b){for(var c in b)a.setAttribute(c,b[c]);return a},o=function(a,b,c,d){a.save(),a.translate(b,c),a.rotate(d),a.translate(-b,-c),a.beginPath()};d._settings={shape:"oval",color:"#000000",diameter:40,range:.2,density:40,speed:2,fps:60},d._cont=null,d._can=null,d._con=null,d._cCan=null,d._cCon=null,d._timer=0,d._currentId=0,d._diameter=d._settings.diameter,d._cRGB={},d._color=d._settings.color,d._shape=d._settings.shape,d._density=d._settings.density,d._range=d._settings.range,d._speed=d._settings.speed,d._fps=d._settings.fps,d._init=function(a,d){var h=this,n=h._settings;if(h.mum=a,h._cont=l("div",h.mum,{className:"canvasloader"}),i)b=e[0],h._can=l("canvas",h._cont),h._con=h._can.getContext("2d"),h._cCan=m(l("canvas",h._cont),{display:"none"}),h._cCon=h._cCan.getContext("2d");else{if(b=e[1],"undefined"==typeof c.vmlSheet){document.getElementsByTagName("head")[0].appendChild(l("style")),c.vmlSheet=document.styleSheets[document.styleSheets.length-1];for(var o=["group","oval","roundrect","fill"],p=0;p<o.length;++p)c.vmlSheet.addRule(o[p],"behavior:url(#default#VML); position:absolute;")}h.vml=l("group",h._cont)}for(var q=d.shape||n.shape,r=0;r<f.length;r++)if(q===f[r]){h._shape=q;break}k=d.safeVML||!0;var s=d.diameter||n.diameter;h._diameter=Math.round(Math.abs(s)),m(this.mum,{"margin-left":Math.round(s*-.5)+"px"});var t=d.density||n.density;h._density=k&&b===e[1]?Math.round(Math.abs(t))<=j?Math.round(Math.abs(t)):j:Math.round(Math.abs(t)),h._density>360&&(h._density=360),h._currentId=0;var u=d.color;h._color=g.test(u)?u:n.color,h._cRGB=h._getRGB(h._color),h._range=Math.abs(d.range||n.range),h._speed=Math.round(Math.abs(d.speed||n.speed)),h._fps=Math.round(Math.abs(d.fps||n.fps)),h._draw(),m(h._cont,{visibility:"hidden",display:"none"})},d._getRGB=function(a){return a="#"===a.charAt(0)?a.substring(1,7):a,{r:parseInt(a.substring(0,2),16),g:parseInt(a.substring(2,4),16),b:parseInt(a.substring(4,6),16)}},d._draw=function(){var a,c,d,g,i,j,k,p,q,r,s,t,u,v=this,w=0,x=v._density,y=Math.round(x*v._range),z=0,A=1e3,B=0,C=v._cCon,D=v._diameter,E=.47;if(b===e[0])for(C.clearRect(0,0,A,A),n(v._can,{width:D,height:D}),n(v._cCan,{width:D,height:D});x>w;){switch(q=y>=w?1-(1-z)/y*w:q=z,j=270-360/x*w,k=j/180*Math.PI,C.fillStyle="rgba("+v._cRGB.r+","+v._cRGB.g+","+v._cRGB.b+","+q.toString()+")",v._shape){case f[0]:case f[1]:a=.07*D,g=D*E+Math.cos(k)*(D*E-a)-D*E,i=D*E+Math.sin(k)*(D*E-a)-D*E,C.beginPath(),v._shape===f[1]?C.arc(.5*D+g,.5*D+i,a*q,0,2*Math.PI,!1):C.arc(.5*D+g,.5*D+i,a,0,2*Math.PI,!1);break;case f[2]:a=.12*D,g=Math.cos(k)*(D*E-a)+.5*D,i=Math.sin(k)*(D*E-a)+.5*D,o(C,g,i,k),C.fillRect(g,i-.5*a,a,a);break;case f[3]:case f[4]:c=.3*D,d=.27*c,g=Math.cos(k)*(d+.13*(D-d))+.5*D,i=Math.sin(k)*(d+.13*(D-d))+.5*D,o(C,g,i,k),v._shape===f[3]?C.fillRect(g,i-.5*d,c,d):(p=.55*d,C.moveTo(g+p,i-.5*d),C.lineTo(g+c-p,i-.5*d),C.quadraticCurveTo(g+c,i-.5*d,g+c,i-.5*d+p),C.lineTo(g+c,i-.5*d+d-p),C.quadraticCurveTo(g+c,i-.5*d+d,g+c-p,i-.5*d+d),C.lineTo(g+p,i-.5*d+d),C.quadraticCurveTo(g,i-.5*d+d,g,i-.5*d+d-p),C.lineTo(g,i-.5*d+p),C.quadraticCurveTo(g,i-.5*d,g+p,i-.5*d))}C.closePath(),C.fill(),C.restore(),++w}else{switch(m(v._cont,{width:D,height:D}),m(v.vml,{width:D,height:D}),v._shape){case f[0]:case f[1]:t="oval",a=.14*A;break;case f[2]:t="roundrect",a=.12*A;break;case f[3]:case f[4]:t="roundrect",a=.3*A}for(c=d=a,g=.5*A-d,i=.5*-d;x>w;){switch(q=y>=w?1-(1-z)/y*w:q=z,j=270-360/x*w,v._shape){case f[1]:c=d=a*q,g=.5*A-.5*a-a*q*.5,i=.5*(a-a*q);break;case f[0]:case f[2]:h&&(i=0,v._shape===f[2]&&(g=.5*A-.5*d));break;case f[3]:case f[4]:c=.95*a,d=.28*c,h?(g=0,i=.5*A-.5*d):(g=.5*A-c,i=.5*-d),B=v._shape===f[4]?.6:0}s=n(m(l("group",v.vml),{width:A,height:A,rotation:j}),{coordsize:A+","+A,coordorigin:.5*-A+","+.5*-A}),r=m(l(t,s,{stroked:!1,arcSize:B}),{width:c,height:d,top:i,left:g}),u=l("fill",r,{color:v._color,opacity:q}),++w}}v._tick(!0)},d._tick=function(a){var c=this,d=c._con,f=c._diameter;a||(c._currentId+=360/c._density*c._speed),b===e[0]?(d.clearRect(0,0,f,f),o(d,.5*f,.5*f,c._currentId/180*Math.PI),d.drawImage(c._cCan,0,0,f,f),d.restore()):(c._currentId>=360&&(c._currentId-=360),m(c.vml,{rotation:c._currentId}))},d.show=function(){var a=this;return a._timer||(a._timer=self.setInterval(function(){a._tick()},Math.round(1e3/a._fps)),m(a._cont,{visibility:"visible",display:"block"})),a},d.hide=function(){var a=this;return a._timer&&(clearInterval(a._timer),a._timer=null,m(a._cont,{visibility:"hidden",display:"none"})),a},d.destruct=function(){var a,b=this;b.hide(),b.mum.removeChild(b._cont);for(a in b)delete b[a],b[a]=null},d.get=function(a){return"undefined"!=typeof a&&this._settings.hasOwnProperty("_"+a.toString())?this._settings[a.toString()]:void 0},a.CanvasLoader=c}(window);